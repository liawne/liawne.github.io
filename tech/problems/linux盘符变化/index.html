<!doctype html><html lang=zh-cn><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><meta charset=utf-8><meta name=generator content="Hugo 0.99.1"><meta name=theme-color content="#fff"><meta name=color-scheme content="light dark"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no, date=no, address=no, email=no"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><title>linux盘符变化 | newiur</title><link rel=stylesheet href=/css/meme.min.css><script src=/js/meme.min.js></script>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap" media=print onload='this.media="all"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap"></noscript><meta name=author content="newiur"><meta name=description content="linux 系统上磁盘盘符发生变化的几种场景，以及如何规避"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=mask-icon href=/icons/safari-pinned-tab.svg color=#2a6df4><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="newiur"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=mobile-web-app-capable content="yes"><meta name=application-name content="newiur"><meta name=msapplication-starturl content="../../../"><meta name=msapplication-TileColor content="#fff"><meta name=msapplication-TileImage content="../../../icons/mstile-150x150.png"><link rel=manifest href=/manifest.json><link rel=canonical href=https://ruisum.top/tech/problems/linux%E7%9B%98%E7%AC%A6%E5%8F%98%E5%8C%96/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2022-06-08T22:41:20+08:00","dateModified":"2022-06-08T22:41:20+08:00","url":"https://ruisum.top/tech/problems/linux%E7%9B%98%E7%AC%A6%E5%8F%98%E5%8C%96/","headline":"linux盘符变化","description":"linux 系统上磁盘盘符发生变化的几种场景，以及如何规避","inLanguage":"zh-CN","articleSection":"tech","wordCount":3873,"image":"https://ruisum.top/icons/apple-touch-icon.png","author":{"@type":"Person","description":"just go go","email":"rwen913@gmail.com","image":"https://ruisum.top/icons/apple-touch-icon.png","url":"https://ruisum.top","name":"newiur"},"license":"[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)","publisher":{"@type":"Organization","name":"newiur","logo":{"@type":"ImageObject","url":"https://ruisum.top/icons/apple-touch-icon.png"},"url":"https://ruisum.top/"},"mainEntityOfPage":{"@type":"WebSite","@id":"https://ruisum.top/"}}</script><meta name=twitter:card content="summary"><meta property="og:title" content="linux盘符变化"><meta property="og:description" content="linux 系统上磁盘盘符发生变化的几种场景，以及如何规避"><meta property="og:url" content="https://ruisum.top/tech/problems/linux%E7%9B%98%E7%AC%A6%E5%8F%98%E5%8C%96/"><meta property="og:site_name" content="newiur"><meta property="og:locale" content="zh"><meta property="og:image" content="https://ruisum.top/icons/apple-touch-icon.png"><meta property="og:type" content="article"><meta property="article:published_time" content="2022-06-08T22:41:20+08:00"><meta property="article:modified_time" content="2022-06-08T22:41:20+08:00"><meta property="article:section" content="tech"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=ZCOOL+XiaoWei&text=newiur%27sBlognewiur&display=swap" media=print onload='this.media="all"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=ZCOOL+XiaoWei&text=newiur%27sBlognewiur&display=swap"></noscript></head><body><div class=container><header class=header><div class=header-wrapper><div class="header-inner single"><div class=site-brand><a href=/ class=brand>newiur</a></div><nav class=nav><ul class=menu id=menu><li class=menu-item><a href=/tags/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="icon tags"><path d="M497.941 225.941 286.059 14.059A48 48 0 00252.118.0H48C21.49.0.0 21.49.0 48v204.118a48 48 0 0014.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882.0l204.118-204.118c18.745-18.745 18.745-49.137.0-67.882zM112 160c-26.51.0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882.0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397.0h48.721a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882z"/></svg><span class=menu-item-name>标签</span></a></li><li class=menu-item><a href=/tech/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tech"><path d="M512 256c0 141.2-114.7 256-256 256C114.8 512 0 397.3.0 256S114.7.0 256 0s256 114.7 256 256zm-32 0c0-123.2-100.3-224-224-224C132.5 32 32 132.5 32 256s100.5 224 224 224 224-100.5 224-224zM160.9 124.6l86.9 37.1-37.1 86.9-86.9-37.1 37.1-86.9zm110 169.1 46.6 94h-14.6l-50-1e2-48.9 1e2h-14l51.1-106.9-22.3-9.4 6-14 68.6 29.1-6 14.3-16.5-7.1zm-11.8-116.3 68.6 29.4-29.4 68.3L230 246l29.1-68.6zm80.3 42.9 54.6 23.1-23.4 54.3-54.3-23.1 23.1-54.3z"/></svg><span class=menu-item-name>技术</span></a></li><li class=menu-item><a href=/life/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon life"><path d="M301.1 212c4.4 4.4 4.4 11.9.0 16.3l-9.7 9.7c-4.4 4.7-11.9 4.7-16.6.0l-10.5-10.5c-4.4-4.7-4.4-11.9.0-16.6l9.7-9.7c4.4-4.4 11.9-4.4 16.6.0l10.5 10.8zm-30.2-19.7c3-3 3-7.8.0-10.5-2.8-3-7.5-3-10.5.0-2.8 2.8-2.8 7.5.0 10.5 3.1 2.8 7.8 2.8 10.5.0zm-26 5.3c-3 2.8-3 7.5.0 10.2 2.8 3 7.5 3 10.5.0 2.8-2.8 2.8-7.5.0-10.2-3-3-7.7-3-10.5.0zm72.5-13.3c-19.9-14.4-33.8-43.2-11.9-68.1 21.6-24.9 40.7-17.2 59.8.8 11.9 11.3 29.3 24.9 17.2 48.2-12.5 23.5-45.1 33.2-65.1 19.1zm47.7-44.5c-8.9-10-23.3 6.9-15.5 16.1 7.4 9 32.1 2.4 15.5-16.1zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-66.2 42.6c2.5-16.1-20.2-16.6-25.2-25.7-13.6-24.1-27.7-36.8-54.5-30.4 11.6-8 23.5-6.1 23.5-6.1.3-6.4.0-13-9.4-24.9 3.9-12.5.3-22.4.3-22.4 15.5-8.6 26.8-24.4 29.1-43.2 3.6-31-18.8-59.2-49.8-62.8-22.1-2.5-43.7 7.7-54.3 25.7-23.2 40.1 1.4 70.9 22.4 81.4-14.4-1.4-34.3-11.9-40.1-34.3-6.6-25.7 2.8-49.8 8.9-61.4.0.0-4.4-5.8-8-8.9.0.0-13.8.0-24.6 5.3 11.9-15.2 25.2-14.4 25.2-14.4.0-6.4-.6-14.9-3.6-21.6-5.4-11-23.8-12.9-31.7 2.8.1-.2.3-.4.4-.5-5 11.9-1.1 55.9 16.9 87.2-2.5 1.4-9.1 6.1-13 10-21.6 9.7-56.2 60.3-56.2 60.3-28.2 10.8-77.2 50.9-70.6 79.7.3 3 1.4 5.5 3 7.5-2.8 2.2-5.5 5-8.3 8.3-11.9 13.8-5.3 35.2 17.7 24.4 15.8-7.2 29.6-20.2 36.3-30.4.0.0-5.5-5-16.3-4.4 27.7-6.6 34.3-9.4 46.2-9.1 8 3.9 8-34.3 8-34.3.0-14.7-2.2-31-11.1-41.5 12.5 12.2 29.1 32.7 28 60.6-.8 18.3-15.2 23-15.2 23-9.1 16.6-43.2 65.9-30.4 106 0 0-9.7-14.9-10.2-22.1-17.4 19.4-46.5 52.3-24.6 64.5 26.6 14.7 108.8-88.6 126.2-142.3 34.6-20.8 55.4-47.3 63.9-65 22 43.5 95.3 94.5 101.1 59z"/></svg><span class=menu-item-name>随笔</span></a></li><li class=menu-item><a href=/about/><span class=menu-item-name>关于</span></a></li><li class=menu-item><a id=theme-switcher href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-light"><path d="M193.2 104.5 242 7a18 18 0 0128 0l48.8 97.5L422.2 70A18 18 0 01442 89.8l-34.5 103.4L505 242a18 18 0 010 28l-97.5 48.8L442 422.2A18 18 0 01422.2 442l-103.4-34.5L270 505a18 18 0 01-28 0l-48.8-97.5L89.8 442A18 18 0 0170 422.2l34.5-103.4-97.5-48.8a18 18 0 010-28l97.5-48.8L70 89.8A18 18 0 0189.8 70zM256 128a128 128 0 10.01.0M256 160a96 96 0 10.01.0"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-dark"><path d="M27 412A256 256 0 10181 5a11.5 11.5.0 00-5 20A201.5 201.5.0 0142 399a11.5 11.5.0 00-15 13"/></svg></a></li></ul></nav></div></div><input type=checkbox id=nav-toggle aria-hidden=true>
<label for=nav-toggle class=nav-toggle></label>
<label for=nav-toggle class=nav-curtain></label></header><main class="main single" id=main><div class=main-inner><article class="content post h-entry" data-align=justify data-type=tech data-toc-num=true><h1 class="post-title p-name">linux盘符变化</h1><div class="post-description p-summary">linux 系统上磁盘盘符发生变化的几种场景，以及如何规避</div><div class=post-meta><time datetime=2022-06-08T22:41:20+08:00 class="post-meta-item modified dt-updated"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M4e2 64h-48V12c0-6.627-5.373-12-12-12h-40c-6.627.0-12 5.373-12 12v52H160V12c0-6.627-5.373-12-12-12h-40c-6.627.0-12 5.373-12 12v52H48C21.49 64 0 85.49.0 112v352c0 26.51 21.49 48 48 48h352c26.51.0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 4e2H54a6 6 0 01-6-6V160h352v298a6 6 0 01-6 6zm-52.849-200.65L198.842 404.519c-4.705 4.667-12.303 4.637-16.971-.068l-75.091-75.699c-4.667-4.705-4.637-12.303.068-16.971l22.719-22.536c4.705-4.667 12.303-4.637 16.97.069l44.104 44.461 111.072-110.181c4.705-4.667 12.303-4.637 16.971.068l22.536 22.718c4.667 4.705 4.636 12.303-.069 16.97z"/></svg>&nbsp;2022.6.8</time>
<span class="post-meta-item category"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>&nbsp;<a href=/tech/ class="category-link p-category">技术</a>/<a href=/tech/problems/ class="category-link p-category">故障排查</a></span>
<span class="post-meta-item wordcount"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3.0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9.0l60.1 60.1c18.8 18.7 18.8 49.1.0 67.9zM284.2 99.8 21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3.0-17l-111-111c-4.8-4.7-12.4-4.7-17.1.0zM124.1 339.9c-5.5-5.5-5.5-14.3.0-19.8l154-154c5.5-5.5 14.3-5.5 19.8.0s5.5 14.3.0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8.0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;3873</span>
<span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5.0-2e2-89.5-2e2-2e2S145.5 56 256 56s2e2 89.5 2e2 2e2-89.5 2e2-2e2 2e2zm61.8-104.4-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6.0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;8&nbsp;分钟</span>
<span class="post-meta-item busuanzi-page-pv" id=busuanzi_container_page_pv><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="icon post-meta-icon"><path d="M288 144a110.94 110.94.0 00-31.24 5 55.4 55.4.0 017.24 27 56 56 0 01-56 56 55.4 55.4.0 01-27-7.24A111.71 111.71.0 10288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35.0 000 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35.0 000-29.19zM288 4e2c-98.65.0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 4e2 288 4e2z"/></svg>&nbsp;<span id=busuanzi_value_page_pv></span></span></div><nav class=contents><h2 id=contents class=contents-title>目录</h2><ol class=toc><li><a id=contents:-背景 href=#-背景># 背景</a><ol><li><a id=contents:-盘符怎么分配的 href=#-盘符怎么分配的># 盘符怎么分配的</a></li><li><a id=contents:-固定盘符的难点 href=#-固定盘符的难点># 固定盘符的难点</a></li><li><a id=contents:-盘符变化的几种场景 href=#-盘符变化的几种场景># 盘符变化的几种场景</a></li></ol></li><li><a id=contents:-固定盘符的方式 href=#-固定盘符的方式># 固定盘符的方式</a><ol><li><a id=contents:-通过-lable-挂载 href=#-通过-lable-挂载># 通过 lable 挂载</a></li><li><a id=contents:-通过-uuid-挂载 href=#-通过-uuid-挂载># 通过 uuid 挂载</a></li><li><a id=contents:-使用-udev-规则集 href=#-使用-udev-规则集># 使用 udev 规则集</a></li></ol></li><li><a id=contents:-udev-相关内容 href=#-udev-相关内容># udev 相关内容</a><ol><li><a id=contents:rhel7centos7-中的-udev-规则配置 href=#rhel7centos7-中的-udev-规则配置>rhel7(centos7) 中的 udev 规则配置</a></li><li><a id=contents:rhel7centos7-中获取设备信息 href=#rhel7centos7-中获取设备信息>rhel7(centos7) 中获取设备信息</a></li><li><a id=contents:rhel6centos6-中获取设备信息 href=#rhel6centos6-中获取设备信息>rhel6(centos6) 中获取设备信息</a></li><li><a id=contents:rhel6centos6-中的-udev-规则配置 href=#rhel6centos6-中的-udev-规则配置>rhel6(centos6) 中的 udev 规则配置</a></li></ol></li><li><a id=contents:-其他 href=#-其他># 其他</a><ol><li><a id=contents:-参考内容 href=#-参考内容># 参考内容</a></li></ol></li></ol></nav><div class="post-body e-content"><h2 id=-背景><a href=#-背景 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:-背景 class=headings># 背景</a></h2><p><code>linux</code> 服务器重启后盘符发生变化，导致之前以盘符写入 <code>/etc/fstab</code> 中的开机挂载项错乱，开机自启的应用将数据写入错误的磁盘。</p><p>查了一下相关信息，<code>linux</code> 系统启动，磁盘设备名称都有可能变化，这是因为驱动加载的顺序、磁盘扫描顺序都不是固定的。在系统开机时，不同的控制器并行检测，先被探测到的先分配盘符，所以盘符乱序在一些场景下属于正常现象。</p><blockquote><p><code>/dev/sdx</code> 的表示形式长期以来一直不是驱动器的稳定标识符（实际上可能从来没有），这些是按照它们被发现的顺序分配的</p></blockquote><h3 id=-盘符怎么分配的><a href=#-盘符怎么分配的 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:-盘符怎么分配的 class=headings># 盘符怎么分配的</a></h3><p><code>linux</code> 上的设备文件名（通常位于 <code>/dev/</code> 目录中）在每次系统启动时动态分配。当内核启动时，会检测到每个可用设备，并向 <code>UDEV（用户空间设备管理）</code> 子系统发送通知。通过将内核设备标识中的信息与 <code>/etc/udev/rules.d</code> 目录中的 <code>UDEV</code> 规则集进行比较，<code>UDEV</code> 为设备分配一个名称并创建一个设备节点，例如 <code>/dev/sda</code> 或 <code>/dev/mapper/mpath1</code>，因此应用程序可以访问设备。</p><h3 id=-固定盘符的难点><a href=#-固定盘符的难点 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:-固定盘符的难点 class=headings># 固定盘符的难点</a></h3><p>尽管 <code>linux</code> 努力在系统重新启动时保持相同的设备名称，但外部环境的变化还是会影响实际的名称显示。</p><blockquote><p>例如：同一 <code>SAN</code> 分区在一个客户端上可能是 <code>/dev/sda</code>，但在另一个集群节点上可能是 <code>/dev/sdf</code>，这取决于每个主机发现设备的顺序，或者哪台机器的<code>多路径链接（multipath link）</code>首先联机。</p></blockquote><p>节点通常在每次启动时以相同的顺序发现其设备，但这种方式不能确保。需要一种方法来保证持久的、可预测的设备标识。</p><h3 id=-盘符变化的几种场景><a href=#-盘符变化的几种场景 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:-盘符变化的几种场景 class=headings># 盘符变化的几种场景</a></h3><ul><li>系统几次启动时，<code>raid</code> 卡状态有差异</li><li>服务器磁盘较多，<code>sata/ssd</code> 混用</li></ul><h2 id=-固定盘符的方式><a href=#-固定盘符的方式 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:-固定盘符的方式 class=headings># 固定盘符的方式</a></h2><h3 id=-通过-lable-挂载><a href=#-通过-lable-挂载 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:-通过-lable-挂载 class=headings># 通过 lable 挂载</a></h3><p>许多文件系统类型支持将任意字符串或标签与每个文件系统相关联。以 <code>ext3</code> 文件系统举例说明：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 获取 label</span>
</span></span><span class=line><span class=cl>$ /sbin/e2label /dev/sda5
</span></span><span class=line><span class=cl>/home
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 配置 /etc/fstab 挂载</span>
</span></span><span class=line><span class=cl><span class=nv>LABEL</span><span class=o>=</span>/HOME /home auto defaults <span class=m>0</span> <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=-通过-uuid-挂载><a href=#-通过-uuid-挂载 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:-通过-uuid-挂载 class=headings># 通过 uuid 挂载</a></h3><p>许多文件系统类型为每个格式化的磁盘分区分配一个<code>通用唯一标识符（Universally Unique Identifier（UUID））</code>。<code>UUID</code> 通常是自动分配的，不建议手动更改该值。还是以 <code>ext3</code> 文件系统为例说明：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 获取 uuid</span>
</span></span><span class=line><span class=cl>$ /sbin/blkid /dev/sda5
</span></span><span class=line><span class=cl>/dev/sda5: <span class=nv>LABEL</span><span class=o>=</span><span class=s2>&#34;/home&#34;</span> <span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;0c960108-7649-4d8c-a28c-2f75e2f906d3&#34;</span> <span class=nv>SEC_TYPE</span><span class=o>=</span><span class=s2>&#34;ext2&#34;</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;ext3&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 配置 /etc/fstab 挂载</span>
</span></span><span class=line><span class=cl><span class=nv>UUID</span><span class=o>=</span>0c96010876494d8ca28c2f75e2f906d3 /home  ext3  defaults <span class=m>0</span> <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=-使用-udev-规则集><a href=#-使用-udev-规则集 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:-使用-udev-规则集 class=headings># 使用 udev 规则集</a></h3><p>最灵活同时配置难度高一些的方式是使用 <code>udev</code>，这种方式可以配置持久的、可预测的设备名称。这涉及创建 <code>udev</code> 匹配规则，该规则使用设备属性来识别设备，然后为其创建设备节点。通常情况下，该规则只是为内核分配的实际<code>低级设备节点（low-level device node）</code>创建一个符号链接。</p><p><strong>使用 multipath 的场景</strong><br>这是用于实现<code>设备映射器多路径设备（device mapper multipath devices）</code>的技术。
内核创建一个 <code>/dev/dm-x</code> 设备；然后 <code>udev</code> 规则和<code>多路径守护进程（multipathing daemon）</code>创建 <code>/dev/mpath/</code> 链接回 <code>/dev/dm-x</code> 设备；然后创建 <code>/dev/mapper/mpathN</code> 或 <code>/dev/mapper/[uuid]</code> 链接。</p><p>在使用 <code>multipath</code> 的场景下，创建哪种类型的 <code>/dev/mapper/</code> 文件名由 <code>/etc/multipath.conf</code> 文件 <code>user_friendly_names</code> 设置控制。 默认设置是：</p><pre tabindex=0><code class=language-editorconfig data-lang=editorconfig>default {
    user_friendly_names yes
}
</code></pre><p>使用该配置会创建完全没有意义的 <code>/dev/mapper/mpathN</code> 名称。建议注释掉这一项配置，这样可以直接使用 <code>/dev/mapper/xxxx</code> 名称，路径可能更难输出，但至少可以在所有集群节点上移植。</p><p><strong>udev rules文件规则</strong><br>下面是一个 <code>udev</code> 匹配规则（centos7之前版本适用）的示例。<br>该行以一系列谓词或<code>匹配表达式（matching expressions）</code>开始，由 <code>==</code> 运算符标记。 如果所有谓词都与已发现设备的谓词匹配，则采取 <code>=</code> 子句表示的操作。</p><pre tabindex=0><code class=language-editorconfig data-lang=editorconfig>SYSFS{vendor}==&#34;iriver&#34; SYSFS{model}==&#34;T10&#34; OWNER=&#34;user&#34; MODE=&#34;0600&#34; SYMLINK+=&#34;iriver%n&#34;
</code></pre><p>示例内容是将第一个 <code>IRiver T10</code> 播放器插入 <code>USB</code> 端口时创建符号链接 <code>/dev/iriver0</code>。 该设备文件访问权限 <code>0600</code> ，用户为 <code>user</code>。<br>首先，<code>USB</code> 子系统发现设备已插入并通知内核，发现的有关设备的属性也会传递给内核; 这些信息最终到达 <code>UDEV</code> 子系统，该子系统开始读取 <code>/etc/udev/rules.d</code> 中的规则集并将设备属性与每个规则的谓词进行匹配。 如果所有谓词都与规则匹配，则执行该规则指定的任何操作。</p><p>编写 <code>UDEV</code> 规则的挑战部分是了解哪些属性可用，以便规则可以正确识别设备。<code>udevinfo （或者 udevadm info）</code> 可以显示规则可用的设备名称和属性。</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 使用 udevinfo 命令</span>
</span></span><span class=line><span class=cl>$ /usr/bin/udevinfo -q all -p /block/sdb
</span></span><span class=line><span class=cl>P: /block/sdb
</span></span><span class=line><span class=cl>N: sdb
</span></span><span class=line><span class=cl>S: disk/by-id/usb-iriver_T10
</span></span><span class=line><span class=cl>S: disk/by-path/pci-0000:00:07.2-usb-0:1:1.0-scsi-0:0:0:0
</span></span><span class=line><span class=cl>E: <span class=nv>ID_VENDOR</span><span class=o>=</span>iriver
</span></span><span class=line><span class=cl>E: <span class=nv>ID_MODEL</span><span class=o>=</span>T10
</span></span><span class=line><span class=cl>E: <span class=nv>ID_REVISION</span><span class=o>=</span>1.00
</span></span><span class=line><span class=cl>E: <span class=nv>ID_SERIAL</span><span class=o>=</span>iriver_T10
</span></span><span class=line><span class=cl>E: <span class=nv>ID_TYPE</span><span class=o>=</span>disk
</span></span><span class=line><span class=cl>E: <span class=nv>ID_BUS</span><span class=o>=</span>usb
</span></span><span class=line><span class=cl>E: <span class=nv>ID_PATH</span><span class=o>=</span>pci-0000:00:07.2-usb-0:1:1.0-scsi-0:0:0:0
</span></span></code></pre></td></tr></table></div></div></div><div class="notice info"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M256 8a248 248 0 100 496 248 248 0 000-496zm0 110a42 42 0 110 84 42 42 0 010-84zm56 254c0 7-5 12-12 12h-88c-7 0-12-5-12-12v-24c0-7 5-12 12-12h12v-64h-12c-7 0-12-5-12-12v-24c0-7 5-12 12-12h64c7 0 12 5 12 12v1e2h12c7 0 12 5 12 12v24z"/></svg></div><p>udevinfo 命令中路径是相对于 <code>/sys/</code> 目录的，而不是传统的根目录，完整的文件名是 <code>/sys/block/sdb</code>。</p></div><p>选择合适属性集去配置，不要过多或过少，能确定匹配设备即可;我们在这里选择使用供应商名称和型号名称，可以使用任何对象设备的属性集进行设置。<br>确定好谓词和操作后，将 <code>rules</code> 文件放在 <code>/etc/udev/rules.d</code> 目录中。不要修改系统原有的 <code>rules</code> 文件，否则更改可能会在包更新时丢失。</p><h2 id=-udev-相关内容><a href=#-udev-相关内容 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:-udev-相关内容 class=headings># udev 相关内容</a></h2><p><code>rhel7（centos7）</code> 和之前版本 <code>rhel（centos)</code> 上的 <code>udev</code> 版本之间的 <code>udev</code> 规则语法略有不同。</p><div class="notice warning"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M256 8a248 248 0 100 496 248 248 0 000-496zm0 110a42 42 0 110 84 42 42 0 010-84zm56 254c0 7-5 12-12 12h-88c-7 0-12-5-12-12v-24c0-7 5-12 12-12h12v-64h-12c-7 0-12-5-12-12v-24c0-7 5-12 12-12h64c7 0 12 5 12 12v1e2h12c7 0 12 5 12 12v24z"/></svg></div><p>本文只讨论 <code>rhel7/8和rhel6</code>，对 <code>rhel5/9</code> 的 <code>udev</code> 配置不在讨论范围内。</p></div><h3 id=rhel7centos7-中的-udev-规则配置><a href=#rhel7centos7-中的-udev-规则配置 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:rhel7centos7-中的-udev-规则配置 class=headings>rhel7(centos7) 中的 udev 规则配置</a></h3><p>要生成拥有唯一名称的磁盘，需要为目标磁盘配置相应的 <code>规则（udev）</code>。每个 <code>udev</code> 规则由三部分组成：</p><blockquote><p>(1)<strong>ACTION</strong>s (2)<strong>FILTER</strong>s (3)<strong>CHANGE</strong>s</p></blockquote><p><strong>ACTION</strong>s(动作): 或何时应用规则。最常见的触发操作是 <code>add</code> 和/或 <code>change</code>。
<strong>FILTER</strong>s(过滤器): 或如何识别目标磁盘以应用更改。有几种常用的磁盘过滤方法，包括通过<code>子系统(subsystem)</code>和 wwid（或其他唯一标识符）。一些过滤器生效范围很广，因为要应用的更改会跨多个磁盘完成，例如更改磁盘上的所有者或访问权限。然而，更常见的是过滤器针对单个磁盘，为此，通常使用一些唯一的标识符，如序列号或 <code>wwid</code>。<br><strong>CHANGE</strong>s(更改): 或者我们想用设备做什么。最常见的更改是创建一个唯一且持久的设备名称，然后应用程序可以使用该名称。</p><p>如下是示例：</p><pre tabindex=0><code class=language-udev data-lang=udev>|&lt;--- ACTIONs ----&gt;|  |&lt;-------------------- FILTERs -------------------&gt;|    |&lt;--------- CHANGEs ----------------&gt;|
ACTION==&#34;add|change&#34;, KERNEL==&#34;sd*&#34;, ENV{ID_SCSI_SERIAL}==&lt;serial-number&gt;&#34;,   SYMLINK+=&#34;&lt;my-persistent-disk-name&gt;%n&#34;
ACTION==&#34;add|change&#34;, KERNEL==&#34;sd*&#34;, ENV{ID_SCSI_SERIAL}==&#34;50014380212E90E0&#34;, SYMLINK+=&#34;data.A%n&#34;
</code></pre><div class="notice info"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M256 8a248 248 0 100 496 248 248 0 000-496zm0 110a42 42 0 110 84 42 42 0 010-84zm56 254c0 7-5 12-12 12h-88c-7 0-12-5-12-12v-24c0-7 5-12 12-12h12v-64h-12c-7 0-12-5-12-12v-24c0-7 5-12 12-12h64c7 0 12 5 12 12v1e2h12c7 0 12 5 12 12v24z"/></svg></div><p>1.<code>%n</code> 是分区号，所以如果 <code>sda</code> 是上面 <code>FILTER</code> 识别的磁盘，那么 <code>sda</code>、<code>sda1</code>、<code>sda2</code> 将同时创建 <code>data.A</code>、<code>data.A1</code>、<code>data.A2</code> 等。<br>2. <code>NAME udev</code> 不要使用内核已经使用的名称（例如 <code>sd* dm* st* nt* eth*</code> 等）。 这种使用不受支持并且可能会导致问题，<code>SYMLINK</code> 值 <code>my-persistent-disk-name</code> 应该是唯一的，而不是内核已经使用的东西。</p></div><p>示例中的规则将识别具有指定序列号的 <code>sdX</code> 磁盘，并在 <code>devfs</code> 中创建唯一的 <code>/dev/my-persistent-disk-name</code> 条目。 然后应用程序使用 <code>/dev/my-persistent-disk-name</code> 而不是尝试使用定义为非持久的 <code>sdX</code>。</p><h3 id=rhel7centos7-中获取设备信息><a href=#rhel7centos7-中获取设备信息 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:rhel7centos7-中获取设备信息 class=headings>rhel7(centos7) 中获取设备信息</a></h3><p>要查找唯一的自标识符（由磁盘本身提供），请使用 <code>udevadm info</code> 命令。 例如：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># udevadm info --query=all /dev/sda | egrep -i &#34;serial|wwn&#34;</span>
</span></span><span class=line><span class=cl>S: disk/by-id/wwn-0x600508b1001ca98d5d765bea5a0dd3fa
</span></span><span class=line><span class=cl>E: <span class=nv>DEVLINKS</span><span class=o>=</span>/dev/disk/by-path/pci-0000:04:00.0-scsi-0:1:0:0 /dev/disk/by-id/scsi-0HP_LOGICAL_VOLUME_00000000 /dev/disk/by-id/scsi-3600508b1001ca98d5d765bea5a0dd3fa /dev/disk/by-id/scsi-SHP_LOGICAL_VOLUME_50014380212E90E0 /dev/disk/by-id/wwn-0x600508b1001ca98d5d765bea5a0dd3fa
</span></span><span class=line><span class=cl>E: <span class=nv>ID_SCSI_SERIAL</span><span class=o>=</span>50014380212E90E0
</span></span><span class=line><span class=cl>E: <span class=nv>ID_SERIAL</span><span class=o>=</span>3600508b1001ca98d5d765bea5a0dd3fa
</span></span><span class=line><span class=cl>E: <span class=nv>ID_SERIAL_SHORT</span><span class=o>=</span>600508b1001ca98d5d765bea5a0dd3fa
</span></span><span class=line><span class=cl>E: <span class=nv>ID_WWN</span><span class=o>=</span>0x600508b1001ca98d
</span></span><span class=line><span class=cl>E: <span class=nv>ID_WWN_VENDOR_EXTENSION</span><span class=o>=</span>0x5d765bea5a0dd3fa
</span></span><span class=line><span class=cl>E: <span class=nv>ID_WWN_WITH_EXTENSION</span><span class=o>=</span>0x600508b1001ca98d5d765bea5a0dd3fa
</span></span><span class=line><span class=cl>E: <span class=nv>SCSI_IDENT_SERIAL</span><span class=o>=</span>50014380212E90E0
</span></span></code></pre></td></tr></table></div></div></div><p><code>E:</code> 表示这些是 <code>ENV{name}="value"</code> 类型，在上面的示例中，使用了 <code>ENV{ID_SCSI_SERIAL}</code>，因为这在当前系统上的磁盘配置中是唯一的。 也可以为此磁盘选择<code>全球名称 (wwid) ENV{ID_WWN} </code>或任何其他命名标识符。</p><p>使用 <code>ENV{name}</code> 子句进行过滤的替代方法是使用 <code>ATTR{name}=="value"</code> 或 <code>ATTRS{name}=="value"</code> 过滤。 再次使用 <code>udevadm</code> 命令可以找到这些信息：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># udevadm info --path=/sys/class/block/sda --attribute-walk | grep -i ww</span>
</span></span><span class=line><span class=cl>    ATTRS<span class=o>{</span>wwid<span class=o>}==</span><span class=s2>&#34;naa.600508b1001ca98d5d765bea5a0dd3fa&#34;</span>
</span></span></code></pre></td></tr></table></div></div></div><p>注意，<code>此 ATTRS{name}</code> 与 <code>ENV{ID_WWN_WITH_EXTENSION}</code> 具有相同的值，<code>但带有naa</code>。</p><p>验证写的 <code>rules</code> 文件：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># udevadm test /block/&lt;sdX&gt; 2&gt;&amp;1 | grep &lt;my-persistent-disk-name&gt;</span>
</span></span></code></pre></td></tr></table></div></div></div><p>验证通过后应用 <code>rules</code> 内容，重新加载并触发内容生效：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># udevadm control --reload-rules</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># udevadm trigger --type=devices --action=change</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NOTE: To monitor the rules, open a monitor <span class=k>while</span> you <span class=k>do</span> the above. In a separate terminal run the udev monitor, control-C to exit.
</span></span><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># udevadm monitor</span>
</span></span></code></pre></td></tr></table></div></div></div><div class="notice warning"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M256 8a248 248 0 100 496 248 248 0 000-496zm0 110a42 42 0 110 84 42 42 0 010-84zm56 254c0 7-5 12-12 12h-88c-7 0-12-5-12-12v-24c0-7 5-12 12-12h12v-64h-12c-7 0-12-5-12-12v-24c0-7 5-12 12-12h64c7 0 12 5 12 12v1e2h12c7 0 12 5 12 12v24z"/></svg></div><p>在 <code>rhel7(centos7)和rhel8(centos8)</code>中，<code>scsi_id</code> 命令位于 <code>/usr/lib/udev</code> 中，扫描的是 <code>SUBSYSTEM</code> 而不是 <code>BUS</code>。</p></div><h3 id=rhel6centos6-中获取设备信息><a href=#rhel6centos6-中获取设备信息 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:rhel6centos6-中获取设备信息 class=headings>rhel6(centos6) 中获取设备信息</a></h3><p>第一步是获取 <code>SCSI</code> 设备的 <code>SCSI</code> 标识符，通常是一个 <code>WWID</code>。 可以使用如下命令获取，命令必须以 <code>root</code> 身份运行，否则不会生成任何输出，因为需要 <code>root</code> 权限才能访问原始设备。<br>要获取 /dev/sda 的标识符，请运行以下命令：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># scsi_id --whitelisted --replace-whitespace --device=/dev/sda</span>
</span></span><span class=line><span class=cl>3500000e012d5ede0
</span></span></code></pre></td></tr></table></div></div></div><p><code>scsi_id</code> 命令向设备发出 <code>SCSI INQUIRY</code> 命令以访问<code>重要产品数据 (VPD(vital product data))</code> 页 <code>0x83</code> 的数据（如果有的话）。该页面包括设备 <code>WWID</code> 以及其他信息。<br>如果 WWID 不可用，则输出基于 <code>VPD</code> 页 <code>0x80</code> 中的序列号 <code>id</code>。由于名义上应该有 <code>WWID（全球标识符）</code>可用，本文中设备标识符将是 <code>WWID</code>。</p><p>以下是基于序列号的 <code>SCSI</code> 标识符示例：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># scsi_id --whitelisted --replace-whitespace --device=/dev/sda</span>
</span></span><span class=line><span class=cl>1ATA_ST3250310AS_9RY3GS4M
</span></span></code></pre></td></tr></table></div></div></div><p><code>scsi_id</code> 命令（长字符串）的结果是当前映射到 <code>/dev/sda</code> 的设备的 <code>WWID</code>。同一设备的每个路径和设备的每个分区，此 <code>WWID</code> 都是相同的。<code>WWID</code> 是持久的，即使在系统中添加或删除其他设备也不会更改。<br>系统重新启动时，<code>WWID</code> 保持相同 。但是设备到 <code>/dev/sda</code> 的映射可能会改变。这就是为什么需要为软件使用创建的静态设备名称的原因。</p><p><code>udevadm</code> 命令同样可用于查找 <code>WWID</code> 信息：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># udevadm info --query all --name=/dev/sdd | grep WWN</span>
</span></span><span class=line><span class=cl>E: <span class=nv>ID_WWN</span><span class=o>=</span>0x500000e012d5ede0
</span></span><span class=line><span class=cl>E: <span class=nv>ID_WWN_WITH_EXTENSION</span><span class=o>=</span>0x500000e012d5ede0
</span></span></code></pre></td></tr></table></div></div></div><div class="notice info"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M256 8a248 248 0 100 496 248 248 0 000-496zm0 110a42 42 0 110 84 42 42 0 010-84zm56 254c0 7-5 12-12 12h-88c-7 0-12-5-12-12v-24c0-7 5-12 12-12h12v-64h-12c-7 0-12-5-12-12v-24c0-7 5-12 12-12h64c7 0 12 5 12 12v1e2h12c7 0 12 5 12 12v24z"/></svg></div><p>优先使用 <code>udevadm</code> 命令获取<code>WWN（World Wide Name，World Wide IDentifier 的另一个名称）</code>和其他信息</p></div><p>还可以使用下面的命令来获取 <code>SCSI</code> 设备的 <code>SERIAL ID</code>：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># udevadm info --query all --name=/dev/sda | grep ID_SERIAL</span>
</span></span><span class=line><span class=cl>E: <span class=nv>ID_SERIAL</span><span class=o>=</span>ST3250310AS_9RY3GS4M
</span></span><span class=line><span class=cl>E: <span class=nv>ID_SERIAL_SHORT</span><span class=o>=</span>9RY3GS4M
</span></span></code></pre></td></tr></table></div></div></div><h3 id=rhel6centos6-中的-udev-规则配置><a href=#rhel6centos6-中的-udev-规则配置 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:rhel6centos6-中的-udev-规则配置 class=headings>rhel6(centos6) 中的 udev 规则配置</a></h3><p>为命名设备创建规则，创建 <code>/etc/udev/rules.d/20-names.rules</code> 文件。加命名规则，格式如下：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>ACTION</span><span class=o>==</span><span class=s2>&#34;add|change&#34;</span>,   <span class=nv>KERNEL</span><span class=o>==</span><span class=s2>&#34;sd*&#34;</span>, <span class=nv>BUS</span><span class=o>==</span><span class=s2>&#34;scsi&#34;</span>, <span class=nv>PROGRAM</span><span class=o>==</span><span class=s2>&#34;/sbin/scsi_id --whitelisted --replace-whitespace --device=%N&#34;</span>, <span class=nv>RESULT</span><span class=o>==</span><span class=s2>&#34;WWID&#34;</span>, <span class=nv>SYMLINK</span><span class=o>+=</span><span class=s2>&#34;devicename%n&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>or using udev ENV syntax:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>ACTION</span><span class=o>==</span><span class=s2>&#34;add|change&#34;</span>, <span class=nv>KERNEL</span><span class=o>==</span><span class=s2>&#34;sd*&#34;</span>, ENV<span class=o>{</span>ID_WWN<span class=o>}==</span><span class=s2>&#34;WWID&#34;</span>, <span class=nv>SYMLINK</span><span class=o>=</span><span class=s2>&#34;devicename%n&#34;</span>   
</span></span></code></pre></td></tr></table></div></div></div><p>将上述模板中的 <code>stringsWWID</code> 和 <code>devicename</code> 替换为在检索到的实际 <code>WWID</code> 和所需的设备名称。<div class="notice info"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M256 8a248 248 0 100 496 248 248 0 000-496zm0 110a42 42 0 110 84 42 42 0 010-84zm56 254c0 7-5 12-12 12h-88c-7 0-12-5-12-12v-24c0-7 5-12 12-12h12v-64h-12c-7 0-12-5-12-12v-24c0-7 5-12 12-12h64c7 0 12 5 12 12v1e2h12c7 0 12 5 12 12v24z"/></svg></div><p>不要使用内核已经使用的名称（例如 <code>sd* dm* st* nt* eth*</code> 等）。 这种使用不受支持并且可能会导致问题，为 <code>SYMLINK</code> 指定的名称值在所有规则中必须是唯一的。</p></div></p><p>具体示例：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>ACTION</span><span class=o>==</span><span class=s2>&#34;add|change&#34;</span>,   <span class=nv>KERNEL</span><span class=o>==</span><span class=s2>&#34;sd*&#34;</span>, <span class=nv>BUS</span><span class=o>==</span><span class=s2>&#34;scsi&#34;</span>, <span class=nv>PROGRAM</span><span class=o>==</span><span class=s2>&#34;/sbin/scsi_id --whitelisted --replace-whitespace --device=%N&#34;</span>, <span class=nv>RESULT</span><span class=o>==</span><span class=s2>&#34;3500000e012d5ede0&#34;</span>, <span class=nv>SYMLINK</span><span class=o>+=</span><span class=s2>&#34;mydiskname%n&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>or using udev ENV syntax:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>ACTION</span><span class=o>==</span><span class=s2>&#34;add|change&#34;</span>, <span class=nv>KERNEL</span><span class=o>==</span><span class=s2>&#34;sd*&#34;</span>, ENV<span class=o>{</span>ID_WWN<span class=o>}==</span><span class=s2>&#34;500000e012d5ede0&#34;</span>, <span class=nv>SYMLINK</span><span class=o>=</span><span class=s2>&#34;mydiskname%n&#34;</span>   
</span></span></code></pre></td></tr></table></div></div></div><p>规则文件生效时将触发系统检查与 <code>/dev/sd*</code> 匹配的所有 <code>SCSI</code> 设备，并检查给定的 <code>WWID</code> <code>500000e012d5ede0</code>。当它找到匹配的设备时，它将创建一个名为 <code>/dev/mydiskname</code> 的符号链接，该链接指向 <code>/dev/sda</code> —— 至少在当前引导周期内。 如果设备上有任何分区，则会创建其他符号链接：<code>/dev/mydiskname1</code> 用于第一个分区 <code>(/dev/sda1)</code>，<code>/dev/mydiskname2</code> 用于第二个分区 <code>(/dev/sda2)</code>，依此类推。</p><p>测试规则文件是否生效：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># /dev/sda 上有分区</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># udevadm test /block/sda 2&gt;&amp;1 | grep mydiskname</span>
</span></span><span class=line><span class=cl>udev_rules_apply_to_event: LINK <span class=s1>&#39;mydiskname&#39;</span> /etc/udev/rules.d/20-names.rules:1
</span></span><span class=line><span class=cl>link_find_prioritized: found <span class=s1>&#39;/sys/devices/pci0000:00/0000:00:1c.0/0000:02:00.0/host0/port-0:0/end_device-0:0/target0:0:0/0:0:0:0/block/sda&#39;</span> claiming <span class=s1>&#39;/dev/.udev/links/mydiskname&#39;</span>
</span></span><span class=line><span class=cl>link_update: creating link <span class=s1>&#39;/dev/mydiskname&#39;</span> to <span class=s1>&#39;/dev/sda&#39;</span>
</span></span><span class=line><span class=cl>node_symlink: creating symlink <span class=s1>&#39;/dev/mydiskname&#39;</span> to <span class=s1>&#39;sda&#39;</span>
</span></span><span class=line><span class=cl>udevadm_test: <span class=nv>DEVLINKS</span><span class=o>=</span>/dev/mydiskname /dev/block/8:0 /dev/disk/by-id/scsi-3500000e012d5ede0 /dev/disk/by-id/wwn-0x500000e012d5ede0
</span></span></code></pre></td></tr></table></div></div></div><p>触发生效：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># add</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># /sbin/udevadm trigger --type=subsystems --action=add</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># /sbin/udevadm trigger --type=devices --action=add</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># change</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># /sbin/udevadm trigger --type=subsystems --action=change</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># /sbin/udevadm trigger --type=devices --action=change</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 触发制定设备</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@host<span class=o>]</span><span class=c1># echo change &gt; /sys/block/sda/sda1/uevent</span>
</span></span></code></pre></td></tr></table></div></div></div><p>检查：</p><pre tabindex=0><code class=language-editorconfig data-lang=editorconfig># ls -l /dev/mydiskname*
lrwxrwxrwx. 1 root root 3 Feb 20 21:52 /dev/mydiskname -&gt; sda
lrwxrwxrwx. 1 root root 3 Feb 20 21:52 /dev/mydiskname1 -&gt; sda1
</code></pre><h2 id=-其他><a href=#-其他 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:-其他 class=headings># 其他</a></h2><h3 id=-参考内容><a href=#-参考内容 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:-参考内容 class=headings># 参考内容</a></h3><p>本文内容参考自：</p><ul><li><a href=https://blog.51cto.com/gehailong/1546206 target=_blank rel=noopener>解析linux下磁盘乱序的问题</a></li><li><a href=https://access.redhat.com/solutions/1135513 target=_blank rel=noopener>What is udev and how do you write custom udev rules in RHEL7 ?</a></li><li><a href=https://www.thegeekdiary.com/inconsistent-device-names-across-reboot-cause-mount-failure-or-incorrect-mount-in-linux/ target=_blank rel=noopener>Inconsistent Device Names Across Reboot Cause Mount Failure Or Incorrect Mount in Linux</a></li><li><a href=https://access.redhat.com/solutions/2975361 target=_blank rel=noopener>How are custom persistent names assigned for SCSI devices using udev in Red Hat Enterprise Linux 7 and 8?</a></li><li><a href=https://access.redhat.com/solutions/45626 target=_blank rel=noopener>How can static names be assigned for SCSI devices using udev in Red Hat Enterprise Linux 6?</a></li></ul></div></article><div class=updated-badge-container><span title="Updated @ 2022-06-08 22:41:20 CST" style=cursor:help><svg xmlns="http://www.w3.org/2000/svg" width="130" height="20" class="updated-badge"><linearGradient id="b" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient><clipPath id="a"><rect width="130" height="20" rx="3" fill="#fff"/></clipPath><g clip-path="url(#a)"><path class="updated-badge-left" d="M0 0h55v20H0z"/><path class="updated-badge-right" d="M55 0h75v20H55z"/><path fill="url(#b)" d="M0 0h130v20H0z"/></g><g fill="#fff" text-anchor="middle" font-size="110"><text x="285" y="150" fill="#010101" fill-opacity=".3" textLength="450" transform="scale(.1)">updated</text><text x="285" y="140" textLength="450" transform="scale(.1)">updated</text><text x="915" y="150" fill="#010101" fill-opacity=".3" textLength="650" transform="scale(.1)">2022-06-08</text><text x="915" y="140" textLength="650" transform="scale(.1)">2022-06-08</text></g></svg></span></div><div class=post-tags><a href=/tags/udev/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>udev</a>
<a href=/tags/linux/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>linux</a>
<a href=/tags/system/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>system</a></div><ul class=post-nav><li class=post-nav-prev><a href=/tech/basics/bash/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E6%9A%82%E5%AD%98%E5%86%85%E5%AE%B9/ rel=prev>&lt; 文件描述符暂存内容</a></li><li class=post-nav-next><a href=/tech/basics/boot_process/systemd%E4%BB%8B%E7%BB%8D/ rel=next>systemd介绍 ></a></li></ul><div class=load-comments><div id=load-comments>加载评论</div></div><div id=vcomments></div></div></main><div id=back-to-top class=back-to-top><a href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a></div><footer id=footer class=footer><div class=footer-inner><div class=site-info>©&nbsp;2022–2022&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3.0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;newiur</div><div class=busuanzi-site-uv-and-pv><span id=busuanzi_container_site_uv>本站访客数&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon busuanzi-site-uv"><path d="M224 256c70.7.0 128-57.3 128-128S294.7.0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2.0 422.4V464c0 26.5 21.5 48 48 48h352c26.5.0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"/></svg>&nbsp;<span id=busuanzi_value_site_uv></span></span>&nbsp;|&nbsp;<span id=busuanzi_container_site_pv>本站访问量&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="icon busuanzi-site-pv"><path d="M288 144a110.94 110.94.0 00-31.24 5 55.4 55.4.0 017.24 27 56 56 0 01-56 56 55.4 55.4.0 01-27-7.24A111.71 111.71.0 10288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35.0 000 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35.0 000-29.19zM288 4e2c-98.65.0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 4e2 288 4e2z"/></svg>&nbsp;<span id=busuanzi_value_site_pv></span></span></div><script src=https://sdk.jinrishici.com/v2/browser/jinrishici.js></script>
<text class=poem_sentence></text>
<text class=poem_info></text>
<script type=text/javascript>jinrishici.load(function(e){var t=document.querySelector(".poem_sentence"),n=document.querySelector(".poem_info");t.innerHTML=e.data.content,n.innerHTML="—  "+e.data.origin.title})</script></div></footer></div><script>function loadComments(){if(!document.getElementById("vcomments"))return;if(typeof Valine=="undefined"){var e=t=>{var e=document.createElement("script");e.defer=!0,e.crossOrigin="anonymous",Object.keys(t).forEach(n=>{e[n]=t[n]}),document.body.appendChild(e)};e({src:"https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js",onload:()=>{newValine()}})}else newValine()}function newValine(){new Valine({el:"#vcomments",appId:"vcDuMPUhVRWqDQ1hhpoM0FkX-gzGzoHsz",appKey:"BuTIa6PLYnI1Po1eBldfdcT1",placeholder:"Just go go",path:location.pathname,avatar:"mm",meta:["nick","mail","link"],pageSize:10,lang:"zh-cn",visitor:!1,highlight:!0,avatarForce:!1,recordIP:!0,serverURLs:'',emojiCDN:'',emojiMaps:{},enableQQ:!1,requiredFields:[]})}</script><script src=https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js></script>
<script>let imgNodes=document.querySelectorAll("div.post-body img");imgNodes=Array.from(imgNodes).filter(e=>e.parentNode.tagName!=="A"),mediumZoom(imgNodes,{background:"hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)"})</script><script src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js type=module defer></script>
<script async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>